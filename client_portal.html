<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JEV å®¢æˆ·ç«¯é—¨æˆ·</title>
    <!-- å¼•å…¥JEV UIæ ·å¼ -->
    <link rel="stylesheet" href="jev_ui_style.css">
    <!-- å¼•å…¥Googleå­—ä½“ -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="navbar-brand">
            <div class="logo">JEV</div>
            <span>å®¢æˆ·ç«¯é—¨æˆ·</span>
        </div>
        <div class="navbar-right">
            <button id="refreshStatusBtn" class="btn btn-secondary">
                ğŸ”„ åˆ·æ–°çŠ¶æ€
            </button>
            <button id="themeToggle" class="btn btn-secondary">
                ğŸŒ™
            </button>
            <button id="userProfileBtn" class="btn btn-outline">
                <span class="status-indicator status-online"></span>
                ç”¨æˆ·ä¸­å¿ƒ
            </button>
        </div>
    </nav>

    <!-- ä¸»å®¹å™¨ -->
    <div class="app-container">
        <!-- å·¦ä¾§è¾¹æ  -->
        <aside class="sidebar">
            <div class="sidebar-section">
                <div class="sidebar-title">ä¸»å¯¼èˆª</div>
                <ul class="nav-menu">
                    <li class="nav-item">
                        <a href="#dashboard" class="nav-link active">
                            <span class="nav-icon">ğŸ“Š</span>
                            ä»ªè¡¨ç›˜
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#upload" class="nav-link">
                            <span class="nav-icon">ğŸ“</span>
                            å›¾ç‰‡ä¸Šä¼ 
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#quote" class="nav-link">
                            <span class="nav-icon">ğŸ’°</span>
                            è·å–æŠ¥ä»·
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#history" class="nav-link">
                            <span class="nav-icon">ğŸ“‹</span>
                            å†å²è®°å½•
                        </a>
                    </li>
                </ul>
            </div>
            <div class="sidebar-section">
                <div class="sidebar-title">ç³»ç»Ÿ</div>
                <ul class="nav-menu">
                    <li class="nav-item">
                        <a href="#settings" class="nav-link">
                            <span class="nav-icon">âš™ï¸</span>
                            è®¾ç½®
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#help" class="nav-link">
                            <span class="nav-icon">â“</span>
                            å¸®åŠ©ä¸­å¿ƒ
                        </a>
                    </li>
                </ul>
            </div>
        </aside>

        <!-- ä¸»å†…å®¹åŒº -->
        <main class="main-content">
            <!-- æ¬¢è¿åŒºåŸŸ -->
            <section id="dashboard" class="card glass">
                <div class="card-header">
                    <div>
                        <h1 class="card-title">æ¬¢è¿ä½¿ç”¨ JEV å®¢æˆ·ç«¯é—¨æˆ·</h1>
                        <p class="card-subtitle">é«˜æ•ˆçš„å›¾åƒå¤„ç†å’Œæ™ºèƒ½æŠ¥ä»·å¹³å°</p>
                    </div>
                    <div class="flex gap-md">
                        <button id="pingTestBtn" class="btn btn-secondary">
                            ğŸ” Ping æµ‹è¯•
                        </button>
                        <button id="viewLogsBtn" class="btn btn-outline">
                            ğŸ“ æŸ¥çœ‹æ—¥å¿—
                        </button>
                    </div>
                </div>
                <div class="card-content">
                    <p>JEV ç³»ç»Ÿä¸ºæ‚¨æä¾›å…ˆè¿›çš„å›¾åƒè¯†åˆ«ã€æ™ºèƒ½æŠ¥ä»·å’Œæ•°æ®åˆ†ææœåŠ¡ã€‚é€šè¿‡ç®€æ´çš„ç•Œé¢ï¼Œæ‚¨å¯ä»¥å¿«é€Ÿå®Œæˆä¸šåŠ¡å¤„ç†ï¼Œæå‡å·¥ä½œæ•ˆç‡ã€‚</p>
                </div>
            </section>

            <!-- åŠŸèƒ½åŒºåŸŸå¡ç‰‡ -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-lg">
                <div class="card glass">
                    <div class="card-header">
                        <h3 class="card-title">å›¾åƒè¯†åˆ«</h3>
                    </div>
                    <div class="card-content">
                        <p>ä¸Šä¼ å›¾ç‰‡ï¼Œç³»ç»Ÿè‡ªåŠ¨è¯†åˆ«å›¾åƒå†…å®¹ï¼Œæå–å…³é”®ä¿¡æ¯ï¼Œä¸ºæ‚¨æä¾›å‡†ç¡®çš„åˆ†æç»“æœã€‚</p>
                        <div class="mt-md">
                            <a href="#upload" class="btn btn-primary">ç«‹å³ä¸Šä¼ </a>
                        </div>
                    </div>
                </div>
                <div class="card glass">
                    <div class="card-header">
                        <h3 class="card-title">æ™ºèƒ½æŠ¥ä»·</h3>
                    </div>
                    <div class="card-content">
                        <p>æ ¹æ®äº§å“ä¿¡æ¯ï¼Œå¿«é€Ÿç”Ÿæˆç²¾å‡†æŠ¥ä»·ï¼Œå¸®åŠ©æ‚¨åšå‡ºæ›´å¥½çš„ä¸šåŠ¡å†³ç­–ã€‚</p>
                        <div class="mt-md">
                            <a href="#quote" class="btn btn-primary">è·å–æŠ¥ä»·</a>
                        </div>
                    </div>
                </div>
                <div class="card glass">
                    <div class="card-header">
                        <h3 class="card-title">æ•°æ®åˆ†æ</h3>
                    </div>
                    <div class="card-content">
                        <p>æŸ¥çœ‹å¤„ç†è®°å½•å’Œæ€§èƒ½æŒ‡æ ‡ï¼Œè·å–ä¸šåŠ¡æ´å¯Ÿå’Œä¼˜åŒ–å»ºè®®ã€‚</p>
                        <div class="mt-md">
                            <a href="#analytics" class="btn btn-primary">æŸ¥çœ‹åˆ†æ</a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å›¾ç‰‡ä¸Šä¼ åŒºåŸŸ -->
            <section id="upload" class="card glass">
                <div class="card-header">
                    <h2 class="card-title">å›¾ç‰‡ä¸Šä¼ </h2>
                    <p class="card-subtitle">ä¸Šä¼ äº§å“å›¾ç‰‡è¿›è¡Œè¯†åˆ«å’Œåˆ†æ</p>
                </div>
                <div class="card-content">
                    <div class="upload-container" id="uploadContainer">
                        <div class="upload-icon">ğŸ“</div>
                        <p>ç‚¹å‡»æˆ–æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„ä¸Šä¼ </p>
                        <p>æ”¯æŒ JPG, PNG, GIF æ ¼å¼ï¼Œæœ€å¤§ 10MB</p>
                        <input type="file" id="fileInput" accept="image/*" multiple>
                    </div>
                    <div class="loading" id="uploadLoading">
                        <div class="loading-spinner"></div>
                        <p>æ­£åœ¨ä¸Šä¼ å’Œå¤„ç†å›¾ç‰‡ï¼Œè¯·ç¨å€™...</p>
                    </div>
                </div>
            </section>

            <!-- æŠ¥ä»·åŒºåŸŸ -->
            <section id="quote" class="card glass">
                <div class="card-header">
                    <h2 class="card-title">è·å–æŠ¥ä»·</h2>
                    <p class="card-subtitle">å¡«å†™äº§å“ä¿¡æ¯ï¼Œè·å–æ™ºèƒ½æŠ¥ä»·</p>
                </div>
                <div class="card-content">
                    <form id="quoteForm">
                        <div class="form-row grid grid-cols-1 md:grid-cols-2 gap-md">
                            <div class="form-group">
                                <label for="productName" class="form-label">äº§å“åç§° *</label>
                                <input type="text" class="form-input" id="productName" placeholder="è¯·è¾“å…¥äº§å“åç§°">
                            </div>
                            <div class="form-group">
                                <label for="productType" class="form-label">äº§å“ç±»å‹ *</label>
                                <select class="form-input" id="productType">
                                    <option value="">è¯·é€‰æ‹©äº§å“ç±»å‹</option>
                                    <option value="type1">ç”µå­å…ƒä»¶</option>
                                    <option value="type2">æœºæ¢°é›¶ä»¶</option>
                                    <option value="type3">å¡‘æ–™é…ä»¶</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row grid grid-cols-1 md:grid-cols-2 gap-md">
                            <div class="form-group">
                                <label for="quantity" class="form-label">æ•°é‡ *</label>
                                <input type="number" class="form-input" id="quantity" placeholder="è¯·è¾“å…¥æ•°é‡">
                            </div>
                            <div class="form-group">
                                <label for="deadline" class="form-label">äº¤ä»˜æœŸé™</label>
                                <input type="date" class="form-input" id="deadline">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="description" class="form-label">äº§å“æè¿°</label>
                            <textarea class="form-input" id="description" rows="4" placeholder="è¯·è¾“å…¥äº§å“æè¿°æˆ–ç‰¹æ®Šè¦æ±‚"></textarea>
                        </div>
                        <div class="flex justify-end mt-md">
                            <button type="submit" class="btn btn-primary">è·å–æŠ¥ä»·</button>
                        </div>
                    </form>
                </div>
            </section>

            <!-- å†å²è®°å½•åŒºåŸŸ -->
            <section id="history" class="card glass">
                <div class="card-header">
                    <h2 class="card-title">å†å²è®°å½•</h2>
                    <div class="flex gap-sm">
                        <select id="historyFilter" class="form-input" style="width: auto;">
                            <option value="all">å…¨éƒ¨è®°å½•</option>
                            <option value="image">å›¾ç‰‡è¯†åˆ«</option>
                            <option value="quote">æŠ¥ä»·è®°å½•</option>
                        </select>
                        <button id="clearHistoryBtn" class="btn btn-outline">æ¸…é™¤å†å²</button>
                    </div>
                </div>
                <div class="card-content">
                    <div id="historyContainer">
                        <p class="text-center text-secondary">æš‚æ— å†å²è®°å½•</p>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- å…¨å±€åŠ è½½æŒ‡ç¤ºå™¨ -->
    <div id="globalLoader" style="
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(16, 20, 24, 0.7);
        backdrop-filter: blur(4px);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        flex-direction: column;
        color: var(--text-primary);
    ">
        <div class="loading-spinner" style="width: 40px; height: 40px; margin-bottom: 16px;"></div>
        <p>å¤„ç†ä¸­ï¼Œè¯·ç¨å€™...</p>
    </div>

    <!-- å¼•å…¥JavaScriptæ¨¡å— -->
    <script src="jev_ui_logic.js"></script>
    <script src="jev_ai_assistant.js"></script>
    <script src="jev_monitor.js"></script>

    <script>
        // å®¢æˆ·ç«¯é—¨æˆ·ç‰¹å®šé€»è¾‘
        document.addEventListener('DOMContentLoaded', () => {
            // æ–‡ä»¶ä¸Šä¼ å¤„ç†
            const uploadContainer = document.getElementById('uploadContainer');
            const fileInput = document.getElementById('fileInput');
            const uploadLoading = document.getElementById('uploadLoading');
            const historyContainer = document.getElementById('historyContainer');

            // ç‚¹å‡»ä¸Šä¼ åŒºåŸŸè§¦å‘æ–‡ä»¶é€‰æ‹©
            uploadContainer.addEventListener('click', () => {
                fileInput.click();
            });

            // æ‹–æ‹½ä¸Šä¼ åŠŸèƒ½
            uploadContainer.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadContainer.style.backgroundColor = 'var(--bg-hover)';
            });

            uploadContainer.addEventListener('dragleave', () => {
                uploadContainer.style.backgroundColor = '';
            });

            uploadContainer.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadContainer.style.backgroundColor = '';
                
                if (e.dataTransfer.files.length) {
                    handleFileUpload(e.dataTransfer.files);
                }
            });

            // æ–‡ä»¶é€‰æ‹©åçš„å¤„ç†
            fileInput.addEventListener('change', () => {
                if (fileInput.files.length) {
                    handleFileUpload(fileInput.files);
                }
            });

            // å¤„ç†æ–‡ä»¶ä¸Šä¼ 
            async function handleFileUpload(files) {
                uploadLoading.style.display = 'block';
                
                try {
                    // ä½¿ç”¨jevUIçš„ä¸Šä¼ åŠŸèƒ½
                    if (window.jevUI) {
                        const results = [];
                        
                        for (let i = 0; i < files.length; i++) {
                            const file = files[i];
                            const result = await window.jevUI.uploadFile(file, '/api/upload');
                            results.push(result);
                        }
                        
                        uploadLoading.style.display = 'none';
                        
                        // æ˜¾ç¤ºä¸Šä¼ æˆåŠŸä¿¡æ¯
                        showUploadSuccess(files.length, results);
                        
                        // æ›´æ–°å†å²è®°å½•
                        loadHistory();
                    } else {
                        // æ¨¡æ‹Ÿä¸Šä¼ è¿‡ç¨‹
                        setTimeout(() => {
                            uploadLoading.style.display = 'none';
                            showUploadSuccess(files.length);
                            loadHistory();
                        }, 2000);
                    }
                } catch (error) {
                    uploadLoading.style.display = 'none';
                    if (window.jevUI) {
                        window.jevUI.showNotification('ä¸Šä¼ å¤±è´¥ï¼š' + error.message, 'error');
                    } else {
                        alert('ä¸Šä¼ å¤±è´¥ï¼Œè¯·é‡è¯•');
                    }
                }
            }

            // æ˜¾ç¤ºä¸Šä¼ æˆåŠŸä¿¡æ¯
            function showUploadSuccess(fileCount, results = null) {
                const message = `æˆåŠŸä¸Šä¼ äº† ${fileCount} ä¸ªæ–‡ä»¶`;
                
                if (window.jevUI) {
                    window.jevUI.showNotification(message, 'success');
                } else {
                    alert(message);
                }
            }

            // æŠ¥ä»·è¡¨å•å¤„ç†
            const quoteForm = document.getElementById('quoteForm');
            
            if (window.jevUI) {
                window.jevUI.handleFormSubmit('quoteForm', async (formData) => {
                    // éªŒè¯è¡¨å•æ•°æ®
                    let isValid = true;
                    
                    if (!formData.productName) {
                        window.jevUI.setFormError('productName', 'è¯·è¾“å…¥äº§å“åç§°');
                        isValid = false;
                    } else {
                        window.jevUI.clearFormError('productName');
                    }
                    
                    if (!formData.productType) {
                        window.jevUI.setFormError('productType', 'è¯·é€‰æ‹©äº§å“ç±»å‹');
                        isValid = false;
                    } else {
                        window.jevUI.clearFormError('productType');
                    }
                    
                    if (!formData.quantity || formData.quantity <= 0) {
                        window.jevUI.setFormError('quantity', 'è¯·è¾“å…¥æœ‰æ•ˆçš„æ•°é‡');
                        isValid = false;
                    } else {
                        window.jevUI.clearFormError('quantity');
                    }
                    
                    if (!isValid) return;
                    
                    try {
                        // è°ƒç”¨æŠ¥ä»·API
                        const response = await window.jevUI.apiRequest('/api/quote', 'POST', formData);
                        
                        if (response.success) {
                            // æ˜¾ç¤ºæŠ¥ä»·ç»“æœ
                            showQuoteResult(response.data);
                            window.jevUI.showNotification('æŠ¥ä»·ç”ŸæˆæˆåŠŸ', 'success');
                            
                            // ä¿å­˜åˆ°æœ¬åœ°å†å²
                            saveQuoteToHistory(response.data);
                            loadHistory();
                        }
                    } catch (error) {
                        // ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®
                        generateMockQuote(formData);
                    }
                });
            } else {
                // å¤‡ç”¨è¡¨å•å¤„ç†
                quoteForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    generateMockQuote(getFormData());
                });
            }

            // è·å–è¡¨å•æ•°æ®
            function getFormData() {
                return {
                    productName: document.getElementById('productName').value,
                    productType: document.getElementById('productType').value,
                    quantity: document.getElementById('quantity').value,
                    deadline: document.getElementById('deadline').value,
                    description: document.getElementById('description').value
                };
            }

            // ç”Ÿæˆæ¨¡æ‹ŸæŠ¥ä»·
            function generateMockQuote(formData) {
                const mockQuote = {
                    id: window.jevUI ? window.jevUI.generateId() : Date.now(),
                    productName: formData.productName,
                    productType: formData.productType,
                    quantity: formData.quantity,
                    unitPrice: Math.floor(Math.random() * 1000) + 100,
                    totalPrice: (Math.floor(Math.random() * 1000) + 100) * parseInt(formData.quantity),
                    currency: 'CNY',
                    generatedAt: new Date().toISOString(),
                    validUntil: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString()
                };
                
                showQuoteResult(mockQuote);
                saveQuoteToHistory(mockQuote);
                loadHistory();
            }

            // æ˜¾ç¤ºæŠ¥ä»·ç»“æœ
            function showQuoteResult(quote) {
                // åˆ›å»ºæ¨¡æ€æ¡†æ˜¾ç¤ºæŠ¥ä»·ç»“æœ
                const modal = document.createElement('div');
                modal.className = 'glass';
                modal.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    padding: var(--spacing-xl);
                    max-width: 500px;
                    width: 90%;
                    z-index: 2000;
                `;
                
                const formatDate = (dateStr) => {
                    return new Date(dateStr).toLocaleDateString('zh-CN');
                };
                
                modal.innerHTML = `
                    <div class="text-right mb-4">
                        <button id="closeQuoteModal" class="btn btn-icon">âœ•</button>
                    </div>
                    <h3 class="font-bold text-xl mb-4">æŠ¥ä»·ç»“æœ</h3>
                    <div class="space-y-3">
                        <div><strong>äº§å“åç§°ï¼š</strong>${quote.productName}</div>
                        <div><strong>äº§å“ç±»å‹ï¼š</strong>${getProductTypeName(quote.productType)}</div>
                        <div><strong>æ•°é‡ï¼š</strong>${quote.quantity}</div>
                        <div><strong>å•ä»·ï¼š</strong>${quote.currency} ${quote.unitPrice.toFixed(2)}</div>
                        <div><strong>æ€»ä»·ï¼š</strong><span class="text-primary font-bold text-lg">${quote.currency} ${quote.totalPrice.toFixed(2)}</span></div>
                        <div><strong>ç”Ÿæˆæ—¶é—´ï¼š</strong>${formatDate(quote.generatedAt)}</div>
                        <div><strong>æŠ¥ä»·æœ‰æ•ˆæœŸè‡³ï¼š</strong>${formatDate(quote.validUntil)}</div>
                    </div>
                    <div class="mt-6 text-center">
                        <button id="downloadQuoteBtn" class="btn btn-primary">ä¸‹è½½æŠ¥ä»·å•</button>
                    </div>
                `;
                
                // åˆ›å»ºé®ç½©
                const overlay = document.createElement('div');
                overlay.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(0, 0, 0, 0.5);
                    backdrop-filter: blur(2px);
                    z-index: 1999;
                `;
                
                document.body.appendChild(overlay);
                document.body.appendChild(modal);
                
                // å…³é—­æŒ‰é’®
                document.getElementById('closeQuoteModal').addEventListener('click', () => {
                    document.body.removeChild(modal);
                    document.body.removeChild(overlay);
                });
                
                // ä¸‹è½½æŒ‰é’®
                document.getElementById('downloadQuoteBtn').addEventListener('click', () => {
                    downloadQuotePDF(quote);
                });
            }

            // è·å–äº§å“ç±»å‹åç§°
            function getProductTypeName(type) {
                const types = {
                    'type1': 'ç”µå­å…ƒä»¶',
                    'type2': 'æœºæ¢°é›¶ä»¶',
                    'type3': 'å¡‘æ–™é…ä»¶'
                };
                return types[type] || type;
            }

            // æ¨¡æ‹Ÿä¸‹è½½æŠ¥ä»·å•
            function downloadQuotePDF(quote) {
                if (window.jevUI) {
                    window.jevUI.showNotification('æŠ¥ä»·å•å·²ä¸‹è½½', 'success');
                } else {
                    alert('æŠ¥ä»·å•å·²ä¸‹è½½');
                }
            }

            // ä¿å­˜æŠ¥ä»·åˆ°å†å²
            function saveQuoteToHistory(quote) {
                const history = JSON.parse(localStorage.getItem('jevHistory') || '[]');
                history.unshift({
                    ...quote,
                    type: 'quote',
                    timestamp: Date.now()
                });
                localStorage.setItem('jevHistory', JSON.stringify(history));
            }

            // åŠ è½½å†å²è®°å½•
            function loadHistory() {
                const history = JSON.parse(localStorage.getItem('jevHistory') || '[]');
                const filter = document.getElementById('historyFilter').value;
                
                // åº”ç”¨è¿‡æ»¤
                let filtered = history;
                if (filter !== 'all') {
                    filtered = history.filter(item => item.type === filter);
                }
                
                if (filtered.length === 0) {
                    historyContainer.innerHTML = '<p class="text-center text-secondary">æš‚æ— å†å²è®°å½•</p>';
                    return;
                }
                
                // æ˜¾ç¤ºå†å²è®°å½•
                historyContainer.innerHTML = filtered.map(item => {
                    const date = new Date(item.timestamp).toLocaleString('zh-CN');
                    
                    if (item.type === 'quote') {
                        return `
                            <div class="glass p-md mb-md">
                                <div class="flex justify-between items-start mb-2">
                                    <div class="font-semibold">${item.productName}</div>
                                    <span class="text-xs bg-primary/20 text-primary px-2 py-1 rounded">æŠ¥ä»·</span>
                                </div>
                                <div class="text-sm text-secondary mb-2">ç”Ÿæˆæ—¶é—´ï¼š${date}</div>
                                <div class="flex justify-between items-center">
                                    <div><strong>æ€»ä»·ï¼š</strong>${item.currency} ${item.totalPrice.toFixed(2)}</div>
                                    <button class="btn btn-sm btn-outline" onclick="viewQuoteDetail('${item.id}')">æŸ¥çœ‹è¯¦æƒ…</button>
                                </div>
                            </div>
                        `;
                    } else {
                        return `
                            <div class="glass p-md mb-md">
                                <div class="flex justify-between items-start mb-2">
                                    <div class="font-semibold">${item.fileName || 'å›¾ç‰‡è¯†åˆ«'}</div>
                                    <span class="text-xs bg-secondary/20 text-secondary px-2 py-1 rounded">å›¾ç‰‡è¯†åˆ«</span>
                                </div>
                                <div class="text-sm text-secondary mb-2">å¤„ç†æ—¶é—´ï¼š${date}</div>
                                <div class="flex justify-end">
                                    <button class="btn btn-sm btn-outline">æŸ¥çœ‹ç»“æœ</button>
                                </div>
                            </div>
                        `;
                    }
                }).join('');
            }

            // åˆ·æ–°çŠ¶æ€æŒ‰é’®
            document.getElementById('refreshStatusBtn').addEventListener('click', async () => {
                try {
                    if (window.jevUI) {
                        const response = await window.jevUI.apiRequest('/status', 'GET');
                        window.jevUI.showNotification('ç³»ç»ŸçŠ¶æ€ï¼šæ­£å¸¸', 'success');
                    } else {
                        alert('ç³»ç»ŸçŠ¶æ€ï¼šæ­£å¸¸');
                    }
                } catch (error) {
                    if (window.jevUI) {
                        window.jevUI.showNotification('è·å–ç³»ç»ŸçŠ¶æ€å¤±è´¥', 'error');
                    }
                }
            });

            // Pingæµ‹è¯•æŒ‰é’®
            document.getElementById('pingTestBtn').addEventListener('click', async () => {
                try {
                    const startTime = performance.now();
                    
                    if (window.jevUI) {
                        await window.jevUI.apiRequest('/ping', 'GET');
                    } else {
                        // æ¨¡æ‹Ÿè¯·æ±‚
                        await new Promise(resolve => setTimeout(resolve, 100));
                    }
                    
                    const endTime = performance.now();
                    const latency = Math.round(endTime - startTime);
                    
                    if (window.jevUI) {
                        window.jevUI.showNotification(`Ping å»¶è¿Ÿï¼š${latency}ms`, 'success');
                    } else {
                        alert(`Ping å»¶è¿Ÿï¼š${latency}ms`);
                    }
                } catch (error) {
                    if (window.jevUI) {
                        window.jevUI.showNotification('Pingå¤±è´¥', 'error');
                    }
                }
            });

            // æ¸…é™¤å†å²æŒ‰é’®
            document.getElementById('clearHistoryBtn').addEventListener('click', () => {
                if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰å†å²è®°å½•å—ï¼Ÿ')) {
                    localStorage.removeItem('jevHistory');
                    loadHistory();
                    if (window.jevUI) {
                        window.jevUI.showNotification('å†å²è®°å½•å·²æ¸…é™¤', 'success');
                    }
                }
            });

            // å†å²è¿‡æ»¤å™¨
            document.getElementById('historyFilter').addEventListener('change', loadHistory);

            // åˆå§‹åŠ è½½å†å²è®°å½•
            loadHistory();
        });
    </script>
</body>
</html>