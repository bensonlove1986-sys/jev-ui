<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JEV ä¸­æ§é¢æ¿</title>
    <!-- å¼•å…¥JEV UIæ ·å¼ -->
    <link rel="stylesheet" href="jev_ui_style.css">
    <!-- å¼•å…¥Googleå­—ä½“ -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="navbar-brand">
            <div class="logo">JEV</div>
            <span>ä¸­æ§é¢æ¿</span>
        </div>
        <div class="navbar-right">
            <!-- æ€§èƒ½ç›‘æ§è¿·ä½ é¢æ¿ -->
            <div id="miniMonitor" class="mini-monitor glass">
                <div class="mini-monitor-item">
                    <span class="monitor-label">Worker</span>
                    <span id="workerStatus" class="monitor-value">ğŸ”µ æ­£å¸¸</span>
                </div>
                <div class="mini-monitor-item">
                    <span class="monitor-label">KV I/O</span>
                    <span id="kvIOValue" class="monitor-value">0</span>
                </div>
                <div class="mini-monitor-item">
                    <span class="monitor-label">å»¶è¿Ÿ</span>
                    <span id="latencyValue" class="monitor-value">--ms</span>
                </div>
                <div class="mini-monitor-item">
                    <span class="monitor-label">è¿æ¥æ•°</span>
                    <span id="connectionsValue" class="monitor-value">0</span>
                </div>
            </div>
            <button id="refreshMetricsBtn" class="btn btn-secondary">
                ğŸ”„ åˆ·æ–°æŒ‡æ ‡
            </button>
            <button id="exportReportBtn" class="btn btn-secondary">
                ğŸ“Š å¯¼å‡ºæŠ¥å‘Š
            </button>
            <button id="themeToggle" class="btn btn-secondary">
                ğŸŒ™
            </button>
            <button id="adminProfileBtn" class="btn btn-outline">
                <span class="status-indicator status-online"></span>
                ç®¡ç†å‘˜
            </button>
        </div>
    </nav>

    <!-- ä¸»å®¹å™¨ -->
    <div class="app-container">
        <!-- å·¦ä¾§è¾¹æ  -->
        <aside class="sidebar">
            <div class="sidebar-section">
                <div class="sidebar-title">ç³»ç»Ÿç›‘æ§</div>
                <ul class="nav-menu">
                    <li class="nav-item">
                        <a href="#dashboard" class="nav-link active">
                            <span class="nav-icon">ğŸ“Š</span>
                            ä»ªè¡¨ç›˜
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#performance" class="nav-link">
                            <span class="nav-icon">âš¡</span>
                            æ€§èƒ½ç›‘æ§
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#logs" class="nav-link">
                            <span class="nav-icon">ğŸ“</span>
                            æ—¥å¿—ç®¡ç†
                        </a>
                    </li>
                </ul>
            </div>
            <div class="sidebar-section">
                <div class="sidebar-title">é…ç½®ç®¡ç†</div>
                <ul class="nav-menu">
                    <li class="nav-item">
                        <a href="#workers" class="nav-link">
                            <span class="nav-icon">ğŸ”§</span>
                            Workerç®¡ç†
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#kv" class="nav-link">
                            <span class="nav-icon">ğŸ—„ï¸</span>
                            KV å­˜å‚¨
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#api" class="nav-link">
                            <span class="nav-icon">ğŸ”Œ</span>
                            API é…ç½®
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#users" class="nav-link">
                            <span class="nav-icon">ğŸ‘¥</span>
                            ç”¨æˆ·ç®¡ç†
                        </a>
                    </li>
                </ul>
            </div>
            <div class="sidebar-section">
                <div class="sidebar-title">é«˜çº§åŠŸèƒ½</div>
                <ul class="nav-menu">
                    <li class="nav-item">
                        <a href="#backup" class="nav-link">
                            <span class="nav-icon">ğŸ’¾</span>
                            å¤‡ä»½æ¢å¤
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#settings" class="nav-link">
                            <span class="nav-icon">âš™ï¸</span>
                            ç³»ç»Ÿè®¾ç½®
                        </a>
                    </li>
                </ul>
            </div>
        </aside>

        <!-- ä¸»å†…å®¹åŒº -->
        <main class="main-content">
            <!-- ä»ªè¡¨ç›˜æ¦‚è§ˆ -->
            <section id="dashboard" class="card glass">
                <div class="card-header">
                    <div>
                        <h1 class="card-title">ä¸­æ§é¢æ¿ä»ªè¡¨ç›˜</h1>
                        <p class="card-subtitle">å®æ—¶ç›‘æ§ç³»ç»Ÿè¿è¡ŒçŠ¶æ€å’Œæ€§èƒ½æŒ‡æ ‡</p>
                    </div>
                    <div class="flex gap-md">
                        <button id="systemCheckBtn" class="btn btn-primary">
                            ğŸ” ç³»ç»Ÿæ£€æŸ¥
                        </button>
                        <button id="viewClientBtn" class="btn btn-outline">
                            ğŸ‘ï¸ æŸ¥çœ‹å®¢æˆ·ç«¯
                        </button>
                    </div>
                </div>
                <div class="card-content">
                    <p>æ¬¢è¿ä½¿ç”¨ JEV ä¸­æ§é¢æ¿ï¼Œæ‚¨å¯ä»¥åœ¨è¿™é‡Œç›‘æ§ç³»ç»Ÿæ€§èƒ½ã€ç®¡ç†é…ç½®å’ŒæŸ¥çœ‹æ—¥å¿—ã€‚å®æ—¶ç›‘æ§åŒºåŸŸæ˜¾ç¤ºäº†ç³»ç»Ÿå…³é”®æŒ‡æ ‡ï¼Œå¸®åŠ©æ‚¨åŠæ—¶å‘ç°å’Œè§£å†³é—®é¢˜ã€‚</p>
                </div>
            </section>

            <!-- å…³é”®æŒ‡æ ‡å¡ç‰‡ -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-lg">
                <div class="card glass">
                    <div class="card-header">
                        <h3 class="card-title">ç³»ç»ŸçŠ¶æ€</h3>
                    </div>
                    <div class="card-content">
                        <div class="metric-large">
                            <span id="systemStatus" class="text-success">ğŸŸ¢ æ­£å¸¸è¿è¡Œ</span>
                        </div>
                        <div class="metric-small mt-sm">
                            <span>æœ€åæ£€æŸ¥ï¼š</span>
                            <span id="lastCheckTime">åˆšåˆš</span>
                        </div>
                    </div>
                </div>
                <div class="card glass">
                    <div class="card-header">
                        <h3 class="card-title">åœ¨çº¿ç”¨æˆ·</h3>
                    </div>
                    <div class="card-content">
                        <div class="metric-large">
                            <span id="onlineUsers">0</span>
                        </div>
                        <div class="metric-small mt-sm">
                            <span>24å°æ—¶å¢é•¿ï¼š</span>
                            <span id="userGrowth" class="text-success">0%</span>
                        </div>
                    </div>
                </div>
                <div class="card glass">
                    <div class="card-header">
                        <h3 class="card-title">è¯·æ±‚æ€»é‡</h3>
                    </div>
                    <div class="card-content">
                        <div class="metric-large">
                            <span id="totalRequests">0</span>
                        </div>
                        <div class="metric-small mt-sm">
                            <span>æˆåŠŸç‡ï¼š</span>
                            <span id="successRate">0%</span>
                        </div>
                    </div>
                </div>
                <div class="card glass">
                    <div class="card-header">
                        <h3 class="card-title">é”™è¯¯ç‡</h3>
                    </div>
                    <div class="card-content">
                        <div class="metric-large" id="errorRateContainer">
                            <span id="errorRate" class="text-success">0%</span>
                        </div>
                        <div class="metric-small mt-sm">
                            <span>è¿‡å»10åˆ†é’Ÿï¼š</span>
                            <span id="recentErrors">0</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- æ€§èƒ½ç›‘æ§åŒºåŸŸ -->
            <section id="performance" class="card glass">
                <div class="card-header">
                    <h2 class="card-title">æ€§èƒ½ç›‘æ§</h2>
                    <div class="flex gap-sm">
                        <select id="timeRange" class="form-input" style="width: auto;">
                            <option value="1h">è¿‡å»1å°æ—¶</option>
                            <option value="6h">è¿‡å»6å°æ—¶</option>
                            <option value="24h">è¿‡å»24å°æ—¶</option>
                            <option value="7d">è¿‡å»7å¤©</option>
                        </select>
                        <button id="refreshPerformanceBtn" class="btn btn-outline">åˆ·æ–°</button>
                    </div>
                </div>
                <div class="card-content">
                    <!-- æ€§èƒ½å›¾è¡¨å®¹å™¨ -->
                    <div class="performance-charts">
                        <!-- CPUä½¿ç”¨ç‡å›¾è¡¨ -->
                        <div class="chart-container">
                            <h4 class="chart-title">CPU ä½¿ç”¨ç‡</h4>
                            <div id="cpuChart" class="chart-area">
                                <div class="chart-placeholder">
                                    <div class="loading-spinner"></div>
                                    <p>æ­£åœ¨åŠ è½½ CPU æ•°æ®...</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- KV I/O å›¾è¡¨ -->
                        <div class="chart-container">
                            <h4 class="chart-title">KV I/O è°ƒç”¨</h4>
                            <div id="kvChart" class="chart-area">
                                <div class="chart-placeholder">
                                    <div class="loading-spinner"></div>
                                    <p>æ­£åœ¨åŠ è½½ KV I/O æ•°æ®...</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- å»¶è¿Ÿå›¾è¡¨ -->
                        <div class="chart-container">
                            <h4 class="chart-title">å“åº”å»¶è¿Ÿ</h4>
                            <div id="latencyChart" class="chart-area">
                                <div class="chart-placeholder">
                                    <div class="loading-spinner"></div>
                                    <p>æ­£åœ¨åŠ è½½å»¶è¿Ÿæ•°æ®...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- æ—¥å¿—ç®¡ç†åŒºåŸŸ -->
            <section id="logs" class="card glass">
                <div class="card-header">
                    <h2 class="card-title">æ—¥å¿—ç®¡ç†</h2>
                    <div class="flex gap-sm">
                        <select id="logLevel" class="form-input" style="width: auto;">
                            <option value="all">æ‰€æœ‰çº§åˆ«</option>
                            <option value="info">INFO</option>
                            <option value="warn">WARN</option>
                            <option value="error">ERROR</option>
                            <option value="debug">DEBUG</option>
                        </select>
                        <input type="text" id="logSearch" class="form-input" placeholder="æœç´¢æ—¥å¿—..." style="width: 200px;">
                        <button id="refreshLogsBtn" class="btn btn-outline">åˆ·æ–°</button>
                        <button id="clearLogsBtn" class="btn btn-outline">æ¸…é™¤</button>
                    </div>
                </div>
                <div class="card-content">
                    <!-- æ—¥å¿—è¡¨æ ¼ -->
                    <div class="logs-container" id="logsContainer">
                        <div class="logs-placeholder">
                            <div class="loading-spinner"></div>
                            <p>æ­£åœ¨åŠ è½½æ—¥å¿—...</p>
                        </div>
                    </div>
                    
                    <!-- åˆ†é¡µæ§ä»¶ -->
                    <div class="pagination mt-md">
                        <button id="prevPageBtn" class="btn btn-outline" disabled>ä¸Šä¸€é¡µ</button>
                        <span id="pageInfo" class="pagination-info">ç¬¬ 1 é¡µï¼Œå…± 1 é¡µ</span>
                        <button id="nextPageBtn" class="btn btn-outline" disabled>ä¸‹ä¸€é¡µ</button>
                    </div>
                </div>
            </section>

            <!-- Workerç®¡ç†åŒºåŸŸ -->
            <section id="workers" class="card glass">
                <div class="card-header">
                    <h2 class="card-title">Worker ç®¡ç†</h2>
                    <div class="flex gap-sm">
                        <button id="deployWorkerBtn" class="btn btn-primary">éƒ¨ç½² Worker</button>
                        <button id="restartWorkerBtn" class="btn btn-secondary">é‡å¯ Worker</button>
                    </div>
                </div>
                <div class="card-content">
                    <div class="worker-info">
                        <div class="info-grid">
                            <div class="info-item">
                                <label>Worker åç§°</label>
                                <span id="workerName">jevshop</span>
                            </div>
                            <div class="info-item">
                                <label>ç‰ˆæœ¬</label>
                                <span id="workerVersion">v1.0.0</span>
                            </div>
                            <div class="info-item">
                                <label>è¿è¡Œæ—¶é—´</label>
                                <span id="workerUptime">0å¤© 0å°æ—¶ 0åˆ†é’Ÿ</span>
                            </div>
                            <div class="info-item">
                                <label>åŒºåŸŸ</label>
                                <span id="workerRegion">global</span>
                            </div>
                            <div class="info-item">
                                <label>ç¯å¢ƒ</label>
                                <span id="workerEnv">production</span>
                            </div>
                            <div class="info-item">
                                <label>å†…å­˜ä½¿ç”¨</label>
                                <span id="workerMemory">0 MB</span>
                            </div>
                        </div>
                        
                        <div class="deploy-controls mt-lg">
                            <h4>éƒ¨ç½²æ§åˆ¶</h4>
                            <div class="form-group">
                                <label class="form-label">éƒ¨ç½²ç‰ˆæœ¬</label>
                                <input type="text" class="form-input" id="deployVersion" placeholder="è¾“å…¥ç‰ˆæœ¬å·">
                            </div>
                            <div class="form-group">
                                <label class="form-label">éƒ¨ç½²å¤‡æ³¨</label>
                                <textarea class="form-input" id="deployNotes" rows="3" placeholder="è¾“å…¥éƒ¨ç½²å¤‡æ³¨ä¿¡æ¯"></textarea>
                            </div>
                            <div class="flex gap-sm mt-md">
                                <button id="deployConfirmBtn" class="btn btn-primary">ç¡®è®¤éƒ¨ç½²</button>
                                <button id="cancelDeployBtn" class="btn btn-outline">å–æ¶ˆ</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- å…¨å±€åŠ è½½æŒ‡ç¤ºå™¨ -->
    <div id="globalLoader" style="
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(16, 20, 24, 0.7);
        backdrop-filter: blur(4px);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        flex-direction: column;
        color: var(--text-primary);
    ">
        <div class="loading-spinner" style="width: 40px; height: 40px; margin-bottom: 16px;"></div>
        <p>å¤„ç†ä¸­ï¼Œè¯·ç¨å€™...</p>
    </div>

    <!-- å¼•å…¥JavaScriptæ¨¡å— -->
    <script src="jev_ui_logic.js"></script>
    <script src="jev_ai_assistant.js"></script>
    <script src="jev_monitor.js"></script>

    <script>
        // ä¸­æ§é¢æ¿ç‰¹å®šé€»è¾‘
        document.addEventListener('DOMContentLoaded', () => {
            // åˆå§‹åŒ–ç›‘æ§é¢æ¿
            if (window.PerformanceMonitor) {
                const monitor = new PerformanceMonitor();
                monitor.initialize();
                monitor.start();
            }
            
            // å¯¼èˆªèœå•å¤„ç†
            const navLinks = document.querySelectorAll('.nav-link');
            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    // ç§»é™¤æ‰€æœ‰æ´»åŠ¨çŠ¶æ€
                    navLinks.forEach(navLink => {
                        navLink.classList.remove('active');
                    });
                    
                    // è®¾ç½®å½“å‰æ´»åŠ¨çŠ¶æ€
                    link.classList.add('active');
                    
                    // æ»šåŠ¨åˆ°å¯¹åº”éƒ¨åˆ†
                    const targetId = link.getAttribute('href');
                    if (targetId && targetId.startsWith('#')) {
                        e.preventDefault();
                        const targetElement = document.querySelector(targetId);
                        if (targetElement) {
                            targetElement.scrollIntoView({ behavior: 'smooth' });
                        }
                    }
                });
            });
            
            // ç³»ç»Ÿæ£€æŸ¥æŒ‰é’®
            document.getElementById('systemCheckBtn').addEventListener('click', async () => {
                showGlobalLoader();
                
                try {
                    // æ¨¡æ‹Ÿç³»ç»Ÿæ£€æŸ¥
                    await new Promise(resolve => setTimeout(resolve, 2000));
                    
                    // æ¨¡æ‹Ÿç»“æœ
                    const mockResults = {
                        workerStatus: 'æ­£å¸¸',
                        kvStatus: 'æ­£å¸¸',
                        apiStatus: 'æ­£å¸¸',
                        dbStatus: 'æ­£å¸¸'
                    };
                    
                    hideGlobalLoader();
                    
                    // æ˜¾ç¤ºç³»ç»Ÿæ£€æŸ¥ç»“æœ
                    showSystemCheckResult(mockResults);
                } catch (error) {
                    hideGlobalLoader();
                    showNotification('ç³»ç»Ÿæ£€æŸ¥å¤±è´¥', 'error');
                }
            });
            
            // æŸ¥çœ‹å®¢æˆ·ç«¯æŒ‰é’®
            document.getElementById('viewClientBtn').addEventListener('click', () => {
                window.location.href = '/ui/client_portal.html';
            });
            
            // æ€§èƒ½ç›‘æ§æ—¶é—´èŒƒå›´åˆ‡æ¢
            document.getElementById('timeRange').addEventListener('change', () => {
                refreshPerformanceCharts();
            });
            
            // åˆ·æ–°æ€§èƒ½å›¾è¡¨
            document.getElementById('refreshPerformanceBtn').addEventListener('click', () => {
                refreshPerformanceCharts();
            });
            
            // åˆ·æ–°æ—¥å¿—
            document.getElementById('refreshLogsBtn').addEventListener('click', () => {
                loadLogs();
            });
            
            // æ¸…é™¤æ—¥å¿—
            document.getElementById('clearLogsBtn').addEventListener('click', () => {
                if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰æ—¥å¿—å—ï¼Ÿ')) {
                    clearLogs();
                }
            });
            
            // æ—¥å¿—æœç´¢
            document.getElementById('logSearch').addEventListener('input', () => {
                filterLogs();
            });
            
            // æ—¥å¿—çº§åˆ«è¿‡æ»¤
            document.getElementById('logLevel').addEventListener('change', () => {
                filterLogs();
            });
            
            // éƒ¨ç½²WorkeræŒ‰é’®
            document.getElementById('deployWorkerBtn').addEventListener('click', () => {
                document.getElementById('deployVersion').value = `v1.0.${Date.now() % 1000}`;
                showNotification('è¯·å¡«å†™éƒ¨ç½²ä¿¡æ¯å¹¶ç‚¹å‡»ç¡®è®¤éƒ¨ç½²', 'info');
            });
            
            // ç¡®è®¤éƒ¨ç½²æŒ‰é’®
            document.getElementById('deployConfirmBtn').addEventListener('click', async () => {
                const version = document.getElementById('deployVersion').value;
                const notes = document.getElementById('deployNotes').value;
                
                if (!version) {
                    showNotification('è¯·è¾“å…¥éƒ¨ç½²ç‰ˆæœ¬', 'error');
                    return;
                }
                
                showGlobalLoader();
                
                try {
                    // æ¨¡æ‹Ÿéƒ¨ç½²è¿‡ç¨‹
                    await new Promise(resolve => setTimeout(resolve, 3000));
                    
                    hideGlobalLoader();
                    showNotification(`Worker éƒ¨ç½²æˆåŠŸï¼ç‰ˆæœ¬: ${version}`, 'success');
                    
                    // æ›´æ–°Workerä¿¡æ¯
                    document.getElementById('workerVersion').textContent = version;
                    document.getElementById('workerUptime').textContent = '0å¤© 0å°æ—¶ 0åˆ†é’Ÿ';
                    
                    // æ¸…ç©ºéƒ¨ç½²è¡¨å•
                    document.getElementById('deployVersion').value = '';
                    document.getElementById('deployNotes').value = '';
                } catch (error) {
                    hideGlobalLoader();
                    showNotification('Worker éƒ¨ç½²å¤±è´¥', 'error');
                }
            });
            
            // å–æ¶ˆéƒ¨ç½²æŒ‰é’®
            document.getElementById('cancelDeployBtn').addEventListener('click', () => {
                document.getElementById('deployVersion').value = '';
                document.getElementById('deployNotes').value = '';
            });
            
            // é‡å¯WorkeræŒ‰é’®
            document.getElementById('restartWorkerBtn').addEventListener('click', async () => {
                if (confirm('ç¡®å®šè¦é‡å¯Workerå—ï¼Ÿè¿™å°†å¯¼è‡´çŸ­æš‚çš„æœåŠ¡ä¸­æ–­ã€‚')) {
                    showGlobalLoader();
                    
                    try {
                        // æ¨¡æ‹Ÿé‡å¯è¿‡ç¨‹
                        await new Promise(resolve => setTimeout(resolve, 2000));
                        
                        hideGlobalLoader();
                        showNotification('Worker é‡å¯æˆåŠŸ', 'success');
                        document.getElementById('workerUptime').textContent = '0å¤© 0å°æ—¶ 0åˆ†é’Ÿ';
                    } catch (error) {
                        hideGlobalLoader();
                        showNotification('Worker é‡å¯å¤±è´¥', 'error');
                    }
                }
            });
            
            // å¯¼å‡ºæŠ¥å‘ŠæŒ‰é’®
            document.getElementById('exportReportBtn').addEventListener('click', async () => {
                showGlobalLoader();
                
                try {
                    // æ¨¡æ‹Ÿç”ŸæˆæŠ¥å‘Š
                    await new Promise(resolve => setTimeout(resolve, 2000));
                    
                    const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
                    const fileName = `jev_metrics_${timestamp}.json`;
                    
                    // æ¨¡æ‹ŸæŠ¥å‘Šæ•°æ®
                    const reportData = {
                        generatedAt: new Date().toISOString(),
                        systemInfo: {
                            workerName: document.getElementById('workerName').textContent,
                            version: document.getElementById('workerVersion').textContent,
                            uptime: document.getElementById('workerUptime').textContent
                        },
                        metrics: {
                            onlineUsers: parseInt(document.getElementById('onlineUsers').textContent),
                            totalRequests: parseInt(document.getElementById('totalRequests').textContent),
                            successRate: document.getElementById('successRate').textContent,
                            errorRate: document.getElementById('errorRate').textContent
                        }
                    };
                    
                    // åˆ›å»ºå¹¶ä¸‹è½½æ–‡ä»¶
                    const blob = new Blob([JSON.stringify(reportData, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = fileName;
                    a.click();
                    URL.revokeObjectURL(url);
                    
                    hideGlobalLoader();
                    showNotification(`æŠ¥å‘Šå·²å¯¼å‡º: ${fileName}`, 'success');
                } catch (error) {
                    hideGlobalLoader();
                    showNotification('æŠ¥å‘Šå¯¼å‡ºå¤±è´¥', 'error');
                }
            });
            
            // åˆ·æ–°æŒ‡æ ‡æŒ‰é’®
            document.getElementById('refreshMetricsBtn').addEventListener('click', () => {
                updateMiniMonitor();
                showNotification('æŒ‡æ ‡å·²åˆ·æ–°', 'success');
            });
            
            // è¾…åŠ©å‡½æ•°
            function showGlobalLoader() {
                document.getElementById('globalLoader').style.display = 'flex';
            }
            
            function hideGlobalLoader() {
                document.getElementById('globalLoader').style.display = 'none';
            }
            
            function showNotification(message, type = 'info') {
                if (window.jevUI && window.jevUI.showNotification) {
                    window.jevUI.showNotification(message, type);
                } else {
                    // ç®€å•çš„é€šçŸ¥å®ç°
                    const notification = document.createElement('div');
                    notification.className = `notification ${type}`;
                    notification.textContent = message;
                    notification.style.cssText = `
                        position: fixed;
                        top: 20px;
                        right: 20px;
                        padding: 12px 20px;
                        border-radius: 8px;
                        background: ${type === 'success' ? '#4CAF50' : type === 'error' ? '#F44336' : '#2196F3'};
                        color: white;
                        z-index: 9999;
                        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                        opacity: 0;
                        transform: translateX(100%);
                        transition: opacity 0.3s, transform 0.3s;
                    `;
                    document.body.appendChild(notification);
                    
                    setTimeout(() => {
                        notification.style.opacity = '1';
                        notification.style.transform = 'translateX(0)';
                    }, 10);
                    
                    setTimeout(() => {
                        notification.style.opacity = '0';
                        notification.style.transform = 'translateX(100%)';
                        setTimeout(() => {
                            document.body.removeChild(notification);
                        }, 300);
                    }, 3000);
                }
            }
            
            function showSystemCheckResult(results) {
                // åˆ›å»ºæ¨¡æ€æ¡†æ˜¾ç¤ºç»“æœ
                const modal = document.createElement('div');
                modal.className = 'glass';
                modal.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    padding: var(--spacing-xl);
                    max-width: 500px;
                    width: 90%;
                    z-index: 2000;
                `;
                
                const allGood = Object.values(results).every(status => status === 'æ­£å¸¸');
                
                modal.innerHTML = `
                    <div class="text-right mb-4">
                        <button id="closeSystemCheckModal" class="btn btn-icon">âœ•</button>
                    </div>
                    <h3 class="font-bold text-xl mb-4">ç³»ç»Ÿæ£€æŸ¥ç»“æœ</h3>
                    <div class="space-y-3">
                        <div><strong>Worker çŠ¶æ€ï¼š</strong><span class="${results.workerStatus === 'æ­£å¸¸' ? 'text-success' : 'text-error'}">${results.workerStatus}</span></div>
                        <div><strong>KV å­˜å‚¨çŠ¶æ€ï¼š</strong><span class="${results.kvStatus === 'æ­£å¸¸' ? 'text-success' : 'text-error'}">${results.kvStatus}</span></div>
                        <div><strong>API æœåŠ¡çŠ¶æ€ï¼š</strong><span class="${results.apiStatus === 'æ­£å¸¸' ? 'text-success' : 'text-error'}">${results.apiStatus}</span></div>
                        <div><strong>æ•°æ®åº“çŠ¶æ€ï¼š</strong><span class="${results.dbStatus === 'æ­£å¸¸' ? 'text-success' : 'text-error'}">${results.dbStatus}</span></div>
                    </div>
                    <div class="mt-6">
                        <div class="p-md bg-${allGood ? 'success' : 'warning'}/20 rounded-lg">
                            <p class="font-medium">${allGood ? 'âœ… ç³»ç»Ÿè¿è¡Œæ­£å¸¸' : 'âš ï¸ ç³»ç»Ÿå­˜åœ¨é—®é¢˜ï¼Œè¯·æ£€æŸ¥'}</p>
                        </div>
                    </div>
                `;
                
                // åˆ›å»ºé®ç½©
                const overlay = document.createElement('div');
                overlay.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(0, 0, 0, 0.5);
                    backdrop-filter: blur(2px);
                    z-index: 1999;
                `;
                
                document.body.appendChild(overlay);
                document.body.appendChild(modal);
                
                // å…³é—­æŒ‰é’®
                document.getElementById('closeSystemCheckModal').addEventListener('click', () => {
                    document.body.removeChild(modal);
                    document.body.removeChild(overlay);
                });
            }
            
            function refreshPerformanceCharts() {
                // æ¨¡æ‹ŸåŠ è½½æ€§èƒ½æ•°æ®
                const charts = ['cpuChart', 'kvChart', 'latencyChart'];
                const chartTitles = ['CPU ä½¿ç”¨ç‡', 'KV I/O è°ƒç”¨', 'å“åº”å»¶è¿Ÿ'];
                
                charts.forEach((chartId, index) => {
                    const chartContainer = document.getElementById(chartId);
                    chartContainer.innerHTML = `
                        <div class="chart-placeholder">
                            <div class="loading-spinner"></div>
                            <p>æ­£åœ¨åŠ è½½ ${chartTitles[index]} æ•°æ®...</p>
                        </div>
                    `;
                    
                    // æ¨¡æ‹Ÿæ•°æ®åŠ è½½å»¶è¿Ÿ
                    setTimeout(() => {
                        renderMockChart(chartId, chartTitles[index]);
                    }, 1000 + index * 500);
                });
            }
            
            function renderMockChart(chartId, title) {
                const chartContainer = document.getElementById(chartId);
                
                // ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®
                const dataPoints = 24;
                const data = [];
                
                for (let i = 0; i < dataPoints; i++) {
                    let value;
                    if (chartId === 'cpuChart') {
                        value = Math.floor(Math.random() * 70) + 10; // 10-80%
                    } else if (chartId === 'kvChart') {
                        value = Math.floor(Math.random() * 1000) + 100; // 100-1100
                    } else {
                        value = Math.floor(Math.random() * 200) + 50; // 50-250ms
                    }
                    data.push(value);
                }
                
                // ç®€å•çš„æ¡å½¢å›¾è¡¨ç¤º
                let chartHTML = '<div class="mock-chart">';
                data.forEach((value, index) => {
                    let height, color;
                    
                    if (chartId === 'cpuChart') {
                        height = `${Math.min(value * 1.2, 100)}%`;
                        color = value > 70 ? '#F44336' : value > 50 ? '#FF9800' : '#4CAF50';
                    } else if (chartId === 'kvChart') {
                        height = `${Math.min(value / 10, 100)}%`;
                        color = '#2196F3';
                    } else {
                        height = `${Math.min(value / 2.5, 100)}%`;
                        color = value > 200 ? '#F44336' : value > 100 ? '#FF9800' : '#4CAF50';
                    }
                    
                    chartHTML += `
                        <div class="chart-bar" style="height: ${height}; background: ${color}" title="${value}"></div>
                    `;
                });
                
                chartHTML += '</div>';
                chartContainer.innerHTML = chartHTML;
            }
            
            function loadLogs() {
                const logsContainer = document.getElementById('logsContainer');
                logsContainer.innerHTML = `
                    <div class="logs-placeholder">
                        <div class="loading-spinner"></div>
                        <p>æ­£åœ¨åŠ è½½æ—¥å¿—...</p>
                    </div>
                `;
                
                // æ¨¡æ‹ŸåŠ è½½æ—¥å¿—
                setTimeout(() => {
                    renderMockLogs();
                }, 1500);
            }
            
            function renderMockLogs() {
                const logsContainer = document.getElementById('logsContainer');
                const logLevel = document.getElementById('logLevel').value;
                const searchTerm = document.getElementById('logSearch').value.toLowerCase();
                
                // ç”Ÿæˆæ¨¡æ‹Ÿæ—¥å¿—æ•°æ®
                const logTypes = ['info', 'warn', 'error', 'debug'];
                const logMessages = [
                    'Worker started successfully',
                    'KV storage initialized',
                    'API endpoint /ping called',
                    'Client connected: 192.168.1.1',
                    'Request processed in 120ms',
                    'Warning: High memory usage',
                    'Error: Failed to connect to database',
                    'Debug: Processing image data',
                    'User login successful',
                    'File uploaded successfully'
                ];
                
                const logs = [];
                for (let i = 0; i < 50; i++) {
                    const type = logTypes[Math.floor(Math.random() * logTypes.length)];
                    const message = logMessages[Math.floor(Math.random() * logMessages.length)];
                    const timestamp = new Date(Date.now() - Math.random() * 86400000).toISOString();
                    
                    // åº”ç”¨è¿‡æ»¤
                    if (logLevel !== 'all' && type !== logLevel) continue;
                    if (searchTerm && !message.toLowerCase().includes(searchTerm)) continue;
                    
                    logs.push({ type, message, timestamp });
                }
                
                if (logs.length === 0) {
                    logsContainer.innerHTML = '<p class="text-center text-secondary">æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„æ—¥å¿—è®°å½•</p>';
                    return;
                }
                
                // æ¸²æŸ“æ—¥å¿—è¡¨æ ¼
                let logsHTML = `
                    <table class="logs-table">
                        <thead>
                            <tr>
                                <th>æ—¶é—´</th>
                                <th>çº§åˆ«</th>
                                <th>æ¶ˆæ¯</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                logs.forEach(log => {
                    const formatTime = (isoString) => {
                        return new Date(isoString).toLocaleString('zh-CN');
                    };
                    
                    let levelClass, levelIcon;
                    switch (log.type) {
                        case 'error':
                            levelClass = 'log-error';
                            levelIcon = 'âŒ';
                            break;
                        case 'warn':
                            levelClass = 'log-warn';
                            levelIcon = 'âš ï¸';
                            break;
                        case 'debug':
                            levelClass = 'log-debug';
                            levelIcon = 'ğŸ›';
                            break;
                        default:
                            levelClass = 'log-info';
                            levelIcon = 'â„¹ï¸';
                    }
                    
                    logsHTML += `
                        <tr>
                            <td class="log-time">${formatTime(log.timestamp)}</td>
                            <td class="log-level ${levelClass}">${levelIcon} ${log.type.toUpperCase()}</td>
                            <td class="log-message">${log.message}</td>
                        </tr>
                    `;
                });
                
                logsHTML += '</tbody></table>';
                logsContainer.innerHTML = logsHTML;
            }
            
            function filterLogs() {
                renderMockLogs();
            }
            
            function clearLogs() {
                const logsContainer = document.getElementById('logsContainer');
                logsContainer.innerHTML = '<p class="text-center text-secondary">æ—¥å¿—å·²æ¸…é™¤</p>';
                showNotification('æ—¥å¿—å·²æ¸…é™¤', 'success');
            }
            
            function updateMiniMonitor() {
                // æ›´æ–°è¿·ä½ ç›‘æ§é¢æ¿
                document.getElementById('workerStatus').textContent = 'ğŸ”µ æ­£å¸¸';
                document.getElementById('kvIOValue').textContent = Math.floor(Math.random() * 1000);
                document.getElementById('latencyValue').textContent = `${Math.floor(Math.random() * 200) + 50}ms`;
                document.getElementById('connectionsValue').textContent = Math.floor(Math.random() * 50);
                
                // æ›´æ–°ä¸»è¦æŒ‡æ ‡
                document.getElementById('onlineUsers').textContent = Math.floor(Math.random() * 100);
                document.getElementById('totalRequests').textContent = Math.floor(Math.random() * 10000);
                document.getElementById('successRate').textContent = `${90 + Math.floor(Math.random() * 10)}%`;
                
                const errorRate = Math.random() * 5;
                document.getElementById('errorRate').textContent = `${errorRate.toFixed(2)}%`;
                
                // è®¾ç½®é”™è¯¯ç‡é¢œè‰²
                const errorRateEl = document.getElementById('errorRate');
                if (errorRate > 3) {
                    errorRateEl.className = 'text-error';
                } else if (errorRate > 1) {
                    errorRateEl.className = 'text-warning';
                } else {
                    errorRateEl.className = 'text-success';
                }
                
                document.getElementById('recentErrors').textContent = Math.floor(Math.random() * 20);
                document.getElementById('lastCheckTime').textContent = 'åˆšåˆš';
            }
            
            // åˆå§‹åŒ–é¡µé¢
            updateMiniMonitor();
            refreshPerformanceCharts();
            loadLogs();
            
            // æ¯10ç§’è‡ªåŠ¨åˆ·æ–°ç›‘æ§æ•°æ®
            setInterval(() => {
                updateMiniMonitor();
            }, 10000);
        });
    </script>
</body>
</html>